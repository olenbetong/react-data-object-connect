(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.dataObjectConnect=b())})(this,function(){"use strict";function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function b(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function c(a,c,d){return c&&b(a.prototype,c),d&&b(a,d),a}function d(){return d=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},d.apply(this,arguments)}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&g(a,b)}function f(a){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},f(a)}function g(a,b){return g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},g(a,b)}function h(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function i(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:h(a)}function j(b){var g=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return function(j){function l(){return"string"==typeof b?window[b]:b}var m=function(b){function m(b){var c;a(this,m),c=i(this,f(m).call(this,b));var d={},e=l();if(g){var j=!0,k=!1,n=void 0;try{for(var o,p,q=e.getFields()[Symbol.iterator]();!(j=(o=q.next()).done);j=!0)p=o.value,d[p.name]=null}catch(a){k=!0,n=a}finally{try{j||null==q.return||q.return()}finally{if(k)throw n}}}else d.data=[];return c.state=Object.assign({canDelete:e.isDeleteAllowed(),canUpdate:e.isUpdateAllowed(),canInsert:e.isInsertAllowed(),currentIndex:e.getCurrentIndex(),isDirty:e.isDirty(),isDeleting:!1,isLoading:!1,isSaving:!1,loadError:null,saveFailed:!1},d),c.handleAfterSave=c.handleAfterSave.bind(h(h(c))),c.handleAllowDeleteChanged=c.handleAllowDeleteChanged.bind(h(h(c))),c.handleAllowInsertChanged=c.handleAllowInsertChanged.bind(h(h(c))),c.handleAllowUpdateChanged=c.handleAllowUpdateChanged.bind(h(h(c))),c.handleBeforeLoad=c.handleBeforeLoad.bind(h(h(c))),c.handleBeforeSave=c.handleBeforeSave.bind(h(h(c))),c.handleCancelEdit=c.handleCancelEdit.bind(h(h(c))),c.handleCurrentIndexChanged=c.handleCurrentIndexChanged.bind(h(h(c))),c.handleDataLoaded=c.handleDataLoaded.bind(h(h(c))),c.handleDataLoadFailed=c.handleDataLoadFailed.bind(h(h(c))),c.handleDirtyChanged=c.handleDirtyChanged.bind(h(h(c))),c.handlePartialDataLoaded=c.handlePartialDataLoaded.bind(h(h(c))),c.handleRecordDeleting=c.handleRecordDeleting.bind(h(h(c))),c.handleRecordDeleted=c.handleRecordDeleted.bind(h(h(c))),c.handleSaveFailed=c.handleSaveFailed.bind(h(h(c))),c.setFieldValue=c.setFieldValue.bind(h(h(c))),c.setFieldValues=c.setFieldValues.bind(h(h(c))),c.updateData=c.updateData.bind(h(h(c))),c.handleFieldChanged=c.updateData,c.handleRecordCreated=c.updateData,c.handleRecordRefreshed=c.updateData,c}return e(m,b),c(m,[{key:"componentDidMount",value:function(){for(var a,b=l(),c=0;c<p.length;c++)a=p[c],b.attachEvent("on"+a,this["handle"+a]);this.updateData()}},{key:"componentWillUnmount",value:function(){for(var a,b=l(),c=0;c<p.length;c++)a=p[c],b.detachEvent("on"+a,this["handle"+a])}},{key:"cancelEdit",value:function(){l().cancelEdit()}},{key:"deleteRow",value:function(a){var b=l();return new Promise(function(c){var d=function(a,b){c({data:b,error:a})};g?b.deleteCurrentRow(d):b.deleteRow(a,d)})}},{key:"endEdit",value:function(a){var b=l();return new Promise(function(c){b.endEdit(function(b,d){"function"==typeof a&&a(b,d),c({data:d,error:b})})})}},{key:"updateData",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=l();if(g){var c=b.currentRow();this.setState(Object.assign(c,a))}else{var d=b.getData(),e=b.currentRow();this.setState(Object.assign({current:e,data:d},a))}}},{key:"handleAllowDeleteChanged",value:function(a){this.setState({canDelete:a})}},{key:"handleAllowUpdateChanged",value:function(a){this.setState({canUpdate:a})}},{key:"handleAllowInsertChanged",value:function(a){this.setState({canInsert:a})}},{key:"handleSaveFailed",value:function(){this.setState({saveFailed:!0})}},{key:"handlePartialDataLoaded",value:function(){return null}},{key:"handleDataLoadFailed",value:function(a){a?this.setState({isLoading:!1,loadError:a}):this.setState({isLoading:!1})}},{key:"handleRecordDeleting",value:function(){this.setState({isDeleting:!0})}},{key:"handleRecordDeleted",value:function(){this.updateData({isDeleting:!1})}},{key:"handleAfterSave",value:function(){this.updateData({isSaving:!1})}},{key:"handleBeforeLoad",value:function(){this.setState({isLoading:!0})}},{key:"handleBeforeSave",value:function(){this.setState({isSaving:!0,saveFailed:!1})}},{key:"handleCancelEdit",value:function(){this.updateData({isSaving:!1})}},{key:"handleCurrentIndexChanged",value:function(a){g?this.updateData():(this.updateData(),this.setState({currentIndex:a}))}},{key:"handleDataLoaded",value:function(){this.updateData({isLoading:!1,isSaving:!1,isDeleting:!1,saveFailed:!1})}},{key:"handleDirtyChanged",value:function(){this.setState({isDirty:l().isDirty()})}},{key:"refreshData",value:function(a){var b=l();return new Promise(function(c){b.refreshDataSource(function(b,d){"function"==typeof a&&a(b,d),c({data:d,error:b})})})}},{key:"refreshRow",value:function(a){var b=l();return new Promise(function(c){b.refreshCurrentRow(function(b,d){"function"==typeof a&&a(b,d),c({data:d,error:b})})})}},{key:"setFieldValue",value:function(a,b){l().currentRow(a,b),this.updateData()}},{key:"setFieldValues",value:function(a){var b=l();for(var c in a)a.hasOwnProperty(c)&&b.currentRow(c,a[c]);this.updateData()}},{key:"setCurrentIndex",value:function(a){l().setCurrentIndex(a)}},{key:"setParameter",value:function(){var a;(a=l()).setParameter.apply(a,arguments)}},{key:"render",value:function(){return k.createElement(j,d({},this.state,{onCancelEdit:this.cancelEdit,onCurrentIndexChange:this.setCurrentIndex,onDeleteRow:this.deleteRow,onEndEdit:this.endEdit,onFieldChange:this.setFieldValue,onFieldsChange:this.setFieldValues,onRefreshData:this.refreshData,onRefreshRow:this.refreshRow,onSetParameter:this.setParameter},this.props))}}]),m}(k.Component);return m.displayName="string"==typeof b?b:b.getDataSourceId(),m.displayName+="(".concat(function(){return j.displayName||j.name||"Component"}(),")"),m}}const{React:k}=window,l=k.PureComponent,m=k.Component,n=k.useState,o=k.useEffect;var p=["AllowDeleteChanged","AllowUpdateChanged","AllowInsertChanged","SaveFailed","PartialDataLoaded","DataLoadFailed","FieldChanged","RecordCreated","RecordRefreshed","RecordDeleting","RecordDeleted","AfterSave","BeforeLoad","BeforeSave","CancelEdit","CurrentIndexChanged","DataLoaded","DirtyChanged"];return j.properties=["onCancelEdit","onCurrentIndexChange","onEndEdit","onDeleteRow","onFieldChange","onFieldsChange","onRefreshData","onRefreshRow","onSetParameter","canDelete","canUpdate","canInsert","currentIndex","isDirty","isDeleting","isLoading","isSaving","loadError","saveFailed"],j});
