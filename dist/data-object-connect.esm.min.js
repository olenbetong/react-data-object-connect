function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var dataObjectConnect=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(a){var n=function(n){function i(a){var n;_classCallCheck(this,i),(n=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,a))).handleAllowDeleteChanged=n.handleAllowDeleteChanged.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleAllowUpdateChanged=n.handleAllowUpdateChanged.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleAllowInsertChanged=n.handleAllowInsertChanged.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleSaveFailed=n.handleSaveFailed.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handlePartialDataLoaded=n.handlePartialDataLoaded.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleDataLoadFailed=n.handleDataLoadFailed.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleFieldChanged=n.handleFieldChanged.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleRecordCreated=n.handleRecordCreated.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleRecordRefreshed=n.handleRecordRefreshed.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleRecordDeleting=n.handleRecordDeleting.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleRecordDeleted=n.handleRecordDeleted.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleAfterSave=n.handleAfterSave.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleBeforeSave=n.handleBeforeSave.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleBeforeLoad=n.handleBeforeLoad.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleCancelEdit=n.handleCancelEdit.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleCurrentIndexChanged=n.handleCurrentIndexChanged.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleDataLoaded=n.handleDataLoaded.bind(_assertThisInitialized(_assertThisInitialized(n))),n.handleDirtyChanged=n.handleDirtyChanged.bind(_assertThisInitialized(_assertThisInitialized(n))),n.setFieldValue=n.setFieldValue.bind(_assertThisInitialized(_assertThisInitialized(n))),n.setFieldValues=n.setFieldValues.bind(_assertThisInitialized(_assertThisInitialized(n)));var d={};if(t){var l=!0,r=!1,s=void 0;try{for(var o,h=e.getFields()[Symbol.iterator]();!(l=(o=h.next()).done);l=!0)d[o.value.name]=null}catch(e){r=!0,s=e}finally{try{l||null==h.return||h.return()}finally{if(r)throw s}}}else d.data=[];return n.state=Object.assign({canDelete:e.isDeleteAllowed(),canUpdate:e.isUpdateAllowed(),canInsert:e.isInsertAllowed(),currentIndex:e.getCurrentIndex(),isDirty:e.isDirty(),isDeleting:!1,isLoading:!1,isSaving:!1,loadError:null,saveFailed:!1},d),n}return _inherits(i,n),_createClass(i,[{key:"componentDidMount",value:function(){e.attachEvent("onAllowDeleteChanged",this.handleAllowDeleteChanged),e.attachEvent("onAllowUpdateChanged",this.handleAllowUpdateChanged),e.attachEvent("onAllowInsertChanged",this.handleAllowInsertChanged),e.attachEvent("onSaveFailed",this.handleSaveFailed),e.attachEvent("onPartialDataLoaded",this.handlePartialDataLoaded),e.attachEvent("onDataLoadFailed",this.handleDataLoadFailed),e.attachEvent("onFieldChanged",this.handleFieldChanged),e.attachEvent("onRecordCreated",this.handleRecordCreated),e.attachEvent("onRecordRefreshed",this.handleRecordRefreshed),e.attachEvent("onRecordDeleting",this.handleRecordDeleting),e.attachEvent("onRecordDeleted",this.handleRecordDeleted),e.attachEvent("onAfterSave",this.handleAfterSave),e.attachEvent("onBeforeLoad",this.handleBeforeLoad),e.attachEvent("onBeforeSave",this.handleBeforeSave),e.attachEvent("onCancelEdit",this.handleCancelEdit),e.attachEvent("onCurrentIndexChanged",this.handleCurrentIndexChanged),e.attachEvent("onDataLoaded",this.handleDataLoaded),e.attachEvent("onDirtyChanged",this.handleDirtyChanged),this.updateData()}},{key:"componentWillUnmount",value:function(){e.detachEvent("onAllowDeleteChanged",this.handleAllowDeleteChanged),e.detachEvent("onAllowUpdateChanged",this.handleAllowUpdateChanged),e.detachEvent("onAllowInsertChanged",this.handleAllowInsertChanged),e.detachEvent("onSaveFailed",this.handleSaveFailed),e.detachEvent("onPartialDataLoaded",this.handlePartialDataLoaded),e.detachEvent("onDataLoadFailed",this.handleDataLoadFailed),e.detachEvent("onFieldChanged",this.handleFieldChanged),e.detachEvent("onRecordCreated",this.handleRecordCreated),e.detachEvent("onRecordRefreshed",this.handleRecordRefreshed),e.detachEvent("onRecordDeleting",this.handleRecordDeleting),e.detachEvent("onRecordDeleted",this.handleRecordDeleted),e.detachEvent("onAfterSave",this.handleAfterSave),e.detachEvent("onBeforeLoad",this.handleBeforeLoad),e.detachEvent("onBeforeSave",this.handleBeforeSave),e.detachEvent("onCancelEdit",this.handleCancelEdit),e.detachEvent("onCurrentIndexChanged",this.handleCurrentIndexChanged),e.detachEvent("onDataLoaded",this.handleDataLoaded),e.detachEvent("onDirtyChanged",this.handleDirtyChanged)}},{key:"cancelEdit",value:function(){e.cancelEdit()}},{key:"deleteRow",value:function(a){return new Promise(function(n){var i=function(e,t){n({data:t,error:e})};t?e.deleteCurrentRow(i):e.deleteRow(a,i)})}},{key:"endEdit",value:function(t){return new Promise(function(a){e.endEdit(function(e,n){"function"==typeof t&&t(e,n),a({data:n,error:e})})})}},{key:"updateData",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t){var n=e.currentRow();this.setState(Object.assign(n,a))}else{var i=e.getData(),d=e.currentRow();this.setState(Object.assign({current:d,data:i},a))}}},{key:"handleAllowDeleteChanged",value:function(e){this.setState({canDelete:e})}},{key:"handleAllowUpdateChanged",value:function(e){this.setState({canUpdate:e})}},{key:"handleAllowInsertChanged",value:function(e){this.setState({canInsert:e})}},{key:"handleSaveFailed",value:function(){this.setState({saveFailed:!0})}},{key:"handlePartialDataLoaded",value:function(){}},{key:"handleDataLoadFailed",value:function(e){e?this.setState({isLoading:!1,loadError:e}):this.setState({isLoading:!1})}},{key:"handleFieldChanged",value:function(e){e.name,e.value;this.updateData()}},{key:"handleRecordCreated",value:function(){this.updateData()}},{key:"handleRecordRefreshed",value:function(){this.updateData()}},{key:"handleRecordDeleting",value:function(){this.setState({isDeleting:!0})}},{key:"handleRecordDeleted",value:function(){this.updateData({isDeleting:!1})}},{key:"handleAfterSave",value:function(){this.updateData({isSaving:!1})}},{key:"handleBeforeLoad",value:function(){this.setState({isLoading:!0})}},{key:"handleBeforeSave",value:function(){this.setState({isSaving:!0,saveFailed:!1})}},{key:"handleCancelEdit",value:function(){this.updateData({isSaving:!1})}},{key:"handleCurrentIndexChanged",value:function(e){t?this.updateData():(this.updateData(),this.setState({currentIndex:e}))}},{key:"handleDataLoaded",value:function(){this.updateData({isLoading:!1,isSaving:!1,isDeleting:!1,saveFailed:!1})}},{key:"handleDirtyChanged",value:function(){this.setState({isDirty:e.isDirty()})}},{key:"refreshData",value:function(t){return new Promise(function(a){e.refreshDataSource(function(e,n){"function"==typeof t&&t(e,n),a({data:n,error:e})})})}},{key:"refreshRow",value:function(t){return new Promise(function(a){e.refreshCurrentRow(function(e,n){"function"==typeof t&&t(e,n),a({data:n,error:e})})})}},{key:"setFieldValue",value:function(t,a){e.currentRow(t,a),this.updateData()}},{key:"setFieldValues",value:function(t){for(var a in t)t.hasOwnProperty(a)&&e.currentRow(a,t[a]);this.updateData()}},{key:"setCurrentIndex",value:function(t){e.setCurrentIndex(t)}},{key:"setParameter",value:function(){e.setParameter.apply(e,arguments)}},{key:"render",value:function(){return React.createElement(a,_extends({},this.state,{onCancelEdit:this.cancelEdit,onCurrentIndexChange:this.setCurrentIndex,onDeleteRow:this.deleteRow,onEndEdit:this.endEdit,onFieldChange:this.setFieldValue,onFieldsChange:this.setFieldValues,onRefreshData:this.refreshData,onRefreshRow:this.refreshRow,onSetParameter:this.setParameter},this.props))}}]),i}(React.Component);return n.displayName="".concat(e.getDataSourceId(),"(").concat(function(){return a.displayName||a.name||"Component"}(),")"),n}};dataObjectConnect.properties=["onCancelEdit","onCurrentIndexChange","onEndEdit","onDeleteRow","onFieldChange","onFieldsChange","onRefreshData","onRefreshRow","onSetParameter","canDelete","canUpdate","canInsert","currentIndex","isDirty","isDeleting","isLoading","isSaving","loadError","saveFailed"];export default dataObjectConnect;
